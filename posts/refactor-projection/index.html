<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>重构 Projection Elimination | Jian Zhang</title><meta name=keywords content><meta name=description content="在 TiDB rc4 版本以前，Projection Elimination 是在 Physical Optimization 阶段完成以后做的。老的 Projection Elimination 只能消除那种做纯拷贝，不交换列的顺序，只改变列的名字的 Project"><meta name=author content="Jian"><link rel=canonical href=https://zz-jason.github.io/posts/refactor-projection/><link href=/assets/css/stylesheet.min.b3cf8fcd850979e55b00e3bf4380b13e3012d79da465c92097dcf8c324188ec9.css integrity="sha256-s8+PzYUJeeVbAOO/Q4CxPjAS152kZckgl9z4wyQYjsk=" rel="preload stylesheet" as=style><link rel=icon href=https://zz-jason.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://zz-jason.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://zz-jason.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://zz-jason.github.io/apple-touch-icon.png><link rel=mask-icon href=https://zz-jason.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.110.0"><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-67872953-1","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script><meta property="og:title" content="重构 Projection Elimination"><meta property="og:description" content="在 TiDB rc4 版本以前，Projection Elimination 是在 Physical Optimization 阶段完成以后做的。老的 Projection Elimination 只能消除那种做纯拷贝，不交换列的顺序，只改变列的名字的 Project"><meta property="og:type" content="article"><meta property="og:url" content="https://zz-jason.github.io/posts/refactor-projection/"><meta property="article:published_time" content="2017-08-12T11:03:22+08:00"><meta property="article:modified_time" content="2017-08-12T11:03:22+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="重构 Projection Elimination"><meta name=twitter:description content="在 TiDB rc4 版本以前，Projection Elimination 是在 Physical Optimization 阶段完成以后做的。老的 Projection Elimination 只能消除那种做纯拷贝，不交换列的顺序，只改变列的名字的 Project"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://zz-jason.github.io/posts/"},{"@type":"ListItem","position":2,"name":"重构 Projection Elimination","item":"https://zz-jason.github.io/posts/refactor-projection/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"重构 Projection Elimination","name":"重构 Projection Elimination","description":"在 TiDB rc4 版本以前，Projection Elimination 是在 Physical Optimization 阶段完成以后做的。老的 Projection Elimination 只能消除那种做纯拷贝，不交换列的顺序，只改变列的名字的 Project","keywords":[],"articleBody":"在 TiDB rc4 版本以前，Projection Elimination 是在 Physical Optimization 阶段完成以后做的。老的 Projection Elimination 只能消除那种做纯拷贝，不交换列的顺序，只改变列的名字的 Projection，Projection 消除后，他的 child 直接使用这个被消除后的 Projection 的 Schema。\n为什么要重构呢？一个原因现在的 Projection Elimination 是在 Physical Optimization 完成以后再做的，如果把这个优化挪到 Logical Optimization 阶段，将会给接下的其他类型的 Logical 或者 Physical 的 Optimization 提供更多更优的选择；另一个原因是现在的 Projection Elimination 并没有把能消除的 Projection 给消除干净，在 Logical Plan build 完成后，整个 Logical Plan 中可能存在的 Projection 可以分为如下几类：\n做表达式计算 剪裁或复制 child 的某些列（schema 中 column 的数量和 child 的不等） 改变 child 某些列的名字（schema 中 column 的数量和 child 的相等） 因为涉及到表达式计算，第一种是无论如何也不能消除的。老的 Projection Elimination 只能消除最后一种，但有些时候第二种我们也能消除。于是我在这 #3687 把 Projection Elimination 给重构了。\n做这个工作的时候我对 TiDB 的 Plan 也不是很熟悉，重构的过程艰辛无比，大家可以在 pr 的 Conversation 页面看到我和 @hanfei1991 @lamxTyler 的大量讨论，重构后，我们的 Projection Elimination 被拆成了两个阶段：一个在 Logical Optimization 阶段，一个在 Physical Optimization 完成后\n为什么要分成两个阶段来做呢？在生成 Physical Plan 的时候，某些 Logical Operator 的 schema 可能跟它对应的 Physical Operator 不同，一个典型的例子就是 LogicalJoin，如果生成的是 PhysicalIndexJoin，可能颠倒左右 child 的列在 schema 中出现的顺序，因此，在 Logical Projection Elimination 阶段，我们要保证整个 Plan 的最顶上一定要有最少一个 Projection，但在做完 Physical Optimization 后这个 Projection 又可能只是改变 child 某些列的名字，因此我们在做完 Physical Optimization 后还要消除一次 Projection，并且这个时候只会存在那种改变 child 某些列名的 Projection\nLogical Optimization 由一个个的 rule 构成，按照先后顺序分别执行这些 rule。Logical Projection Elimanation 对应的 rule 是 projectionEliminater，放在了 columnPruner 后面。还是按照前文说的，我们需要保留至少一个 Projection 来保序。整个 logical plan 需要保序，如果有 Union，那么以 Union 的 child 为 root 的 plan 也需要保序。Projection 的消除是从底向上的，在消除当前这个 Projection 的时候，以当前 operator 为 root 的 plan 已经完成了 Logical Projection Elimination 的过程，当判断到当前的 Projection 属于可以消除的那两种后，还需要判断消除当前这个 Projection 后整个 plan 是否可以保序，只有在能保序的情况下，这个 Plan 才能够消除，换句话说，只有在这个 Projection 和 root 或者 Union 的路径上还有 Projection，它才可以被消除\n最后，在 Physical Optimization 完成后，其实也是整个 Plan 做完了以后，再来扫一下尾。这时候只有第二种 Projection 能够消除了\nProjection Elimination 重构后，如果你用的是 rc3 版本的 TiDB 并且包含了这个 commit，那么可能会出现 bug。在 rc3，如果使用 tikv 的话，会走老 plan，这时候在 Logical Optimization 的 ppdSolver rule 里面会做 Join Reorder，Join Reorder 后不会去更新父亲的 schema，如果父亲不是 Projection，这个时候就可能出现 bug 了，如果遇到这种情况，请升级 rc4，因为 rc4 废弃老 planer 使用新 planner，这个问题在 rc3 并没有修复\n","wordCount":"1175","inLanguage":"en","datePublished":"2017-08-12T11:03:22+08:00","dateModified":"2017-08-12T11:03:22+08:00","author":{"@type":"Person","name":"Jian"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://zz-jason.github.io/posts/refactor-projection/"},"publisher":{"@type":"Organization","name":"Jian Zhang","logo":{"@type":"ImageObject","url":"https://zz-jason.github.io/favicon.ico"}}}</script></head><body id=top><noscript><style type=text/css>#theme-toggle,.top-link{display:none}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://zz-jason.github.io/ accesskey=h title="Jian Zhang (Alt + H)">Jian Zhang</a>
<span class=logo-switches></span></div><ul id=menu onscroll=menu_on_scroll()><li><a href=https://zz-jason.github.io/ title=Home><span>Home</span></a></li><li><a href=https://zz-jason.github.io/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://zz-jason.github.io/posts/ title=Archives><span>Archives</span></a></li><li><a href=https://zz-jason.github.io/about/ title=About><span>About</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>重构 Projection Elimination</h1><div class=post-meta>August 12, 2017&nbsp;·&nbsp;3 min&nbsp;·&nbsp;Jian</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><div class=details>Table of Contents</div></summary><div class=inner></div></details></div><div class=post-content><p>在 TiDB rc4 版本以前，Projection Elimination 是在 Physical Optimization 阶段完成以后做的。老的 Projection Elimination 只能消除那种做纯拷贝，不交换列的顺序，只改变列的名字的 Projection，Projection 消除后，他的 child 直接使用这个被消除后的 Projection 的 Schema。</p><p>为什么要重构呢？一个原因现在的 Projection Elimination 是在 Physical Optimization 完成以后再做的，如果把这个优化挪到 Logical Optimization 阶段，将会给接下的其他类型的 Logical 或者 Physical 的 Optimization 提供更多更优的选择；另一个原因是现在的 Projection Elimination 并没有把能消除的 Projection 给消除干净，在 Logical Plan build 完成后，整个 Logical Plan 中可能存在的 Projection 可以分为如下几类：</p><ul><li>做表达式计算</li><li>剪裁或复制 child 的某些列（schema 中 column 的数量和 child 的不等）</li><li>改变 child 某些列的名字（schema 中 column 的数量和 child 的相等）</li></ul><p>因为涉及到表达式计算，第一种是无论如何也不能消除的。老的 Projection Elimination 只能消除最后一种，但有些时候第二种我们也能消除。于是我在这 <a href=https://github.com/pingcap/tidb/pull/3687>#3687</a> 把 Projection Elimination 给重构了。</p><p>做这个工作的时候我对 TiDB 的 Plan 也不是很熟悉，重构的过程艰辛无比，大家可以在 pr 的 Conversation 页面看到我和 <a href=https://github.com/hanfei1991>@hanfei1991</a> <a href=https://github.com/lamxTyler>@lamxTyler</a> 的大量讨论，重构后，我们的 Projection Elimination 被拆成了两个阶段：一个在 Logical Optimization 阶段，一个在 Physical Optimization 完成后</p><p>为什么要分成两个阶段来做呢？在生成 Physical Plan 的时候，某些 Logical Operator 的 schema 可能跟它对应的 Physical Operator 不同，一个典型的例子就是 LogicalJoin，如果生成的是 PhysicalIndexJoin，可能颠倒左右 child 的列在 schema 中出现的顺序，因此，在 Logical Projection Elimination 阶段，我们要保证整个 Plan 的最顶上一定要有最少一个 Projection，但在做完 Physical Optimization 后这个 Projection 又可能只是改变 child 某些列的名字，因此我们在做完 Physical Optimization 后还要消除一次 Projection，并且这个时候只会存在那种改变 child 某些列名的 Projection</p><p>Logical Optimization 由一个个的 rule 构成，按照先后顺序分别执行这些 rule。Logical Projection Elimanation 对应的 rule 是 projectionEliminater，放在了 columnPruner 后面。还是按照前文说的，我们需要保留至少一个 Projection 来保序。整个 logical plan 需要保序，如果有 Union，那么以 Union 的 child 为 root 的 plan 也需要保序。Projection 的消除是从底向上的，在消除当前这个 Projection 的时候，以当前 operator 为 root 的 plan 已经完成了 Logical Projection Elimination 的过程，当判断到当前的 Projection 属于可以消除的那两种后，还需要判断消除当前这个 Projection 后整个 plan 是否可以保序，只有在能保序的情况下，这个 Plan 才能够消除，换句话说，只有在这个 Projection 和 root 或者 Union 的路径上还有 Projection，它才可以被消除</p><p>最后，在 Physical Optimization 完成后，其实也是整个 Plan 做完了以后，再来扫一下尾。这时候只有第二种 Projection 能够消除了</p><p>Projection Elimination 重构后，如果你用的是 rc3 版本的 TiDB 并且包含了这个 commit，那么可能会出现 bug。在 rc3，如果使用 tikv 的话，会走老 plan，这时候在 Logical Optimization 的 ppdSolver rule 里面会做 Join Reorder，Join Reorder 后不会去更新父亲的 schema，如果父亲不是 Projection，这个时候就可能出现 bug 了，如果遇到这种情况，请升级 rc4，因为 rc4 废弃老 planer 使用新 planner，这个问题在 rc3 并没有修复</p></div><footer class=post-footer><nav class=paginav><a class=prev href=https://zz-jason.github.io/posts/refactor-explain/><span class=title>« Prev Page</span><br><span>重构 EXPLAIN</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share 重构 Projection Elimination on twitter" href="https://twitter.com/intent/tweet/?text=%e9%87%8d%e6%9e%84%20Projection%20Elimination&url=https%3a%2f%2fzz-jason.github.io%2fposts%2frefactor-projection%2f&hashtags="><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share 重构 Projection Elimination on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fzz-jason.github.io%2fposts%2frefactor-projection%2f&title=%e9%87%8d%e6%9e%84%20Projection%20Elimination&summary=%e9%87%8d%e6%9e%84%20Projection%20Elimination&source=https%3a%2f%2fzz-jason.github.io%2fposts%2frefactor-projection%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share 重构 Projection Elimination on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fzz-jason.github.io%2fposts%2frefactor-projection%2f&title=%e9%87%8d%e6%9e%84%20Projection%20Elimination"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share 重构 Projection Elimination on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fzz-jason.github.io%2fposts%2frefactor-projection%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share 重构 Projection Elimination on whatsapp" href="https://api.whatsapp.com/send?text=%e9%87%8d%e6%9e%84%20Projection%20Elimination%20-%20https%3a%2f%2fzz-jason.github.io%2fposts%2frefactor-projection%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share 重构 Projection Elimination on telegram" href="https://telegram.me/share/url?text=%e9%87%8d%e6%9e%84%20Projection%20Elimination&url=https%3a%2f%2fzz-jason.github.io%2fposts%2frefactor-projection%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer><script src=https://utteranc.es/client.js repo=zz-jason/zz-jason.github.io issue-term=pathname theme=github-light crossorigin=anonymous async></script></article></main><footer class=footer><span>&copy; 2023 <a href=https://zz-jason.github.io/>Jian Zhang</a></span>
<span>&#183;</span>
<span>Powered by <a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a></span>
<span>&#183;</span>
<span>Theme <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script defer src=/assets/js/highlight.min.b95bacdc39e37a332a9f883b1e78be4abc1fdca2bc1f2641f55e3cd3dabd4d61.js integrity="sha256-uVus3DnjejMqn4g7Hni+Srwf3KK8HyZB9V4809q9TWE=" onload=hljs.initHighlightingOnLoad()></script>
<script>window.onload=function(){localStorage.getItem("menu-scroll-position")&&(document.getElementById("menu").scrollLeft=localStorage.getItem("menu-scroll-position"))},document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})});var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")};function menu_on_scroll(){localStorage.setItem("menu-scroll-position",document.getElementById("menu").scrollLeft)}</script></body></html>